<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>シンプル電卓</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="bg-white rounded-lg shadow-lg p-8 w-80">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">電卓</h1>
        
        <div class="mb-6">
            <input 
                type="text" 
                id="display" 
                class="w-full bg-gray-200 text-right text-3xl p-4 rounded-lg font-mono border-2 border-gray-300 focus:outline-none focus:border-blue-500"
                readonly
            />
        </div>

        <div class="grid grid-cols-4 gap-3">
            <!-- Clear button -->
            <button class="col-span-2 bg-red-500 hover:bg-red-600 text-white font-bold py-4 rounded-lg text-xl transition" onclick="clearDisplay()">
                C
            </button>
            <button class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-4 rounded-lg text-xl transition" onclick="addOperator('/')">
                ÷
            </button>
            <button class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-4 rounded-lg text-xl transition" onclick="addOperator('*')">
                ×
            </button>

            <!-- Number pad and operators -->
            <button class="bg-gray-300 hover:bg-gray-400 font-bold py-4 rounded-lg text-xl transition" onclick="addNumber('7')">7</button>
            <button class="bg-gray-300 hover:bg-gray-400 font-bold py-4 rounded-lg text-xl transition" onclick="addNumber('8')">8</button>
            <button class="bg-gray-300 hover:bg-gray-400 font-bold py-4 rounded-lg text-xl transition" onclick="addNumber('9')">9</button>
            <button class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-4 rounded-lg text-xl transition" onclick="addOperator('-')">−</button>

            <button class="bg-gray-300 hover:bg-gray-400 font-bold py-4 rounded-lg text-xl transition" onclick="addNumber('4')">4</button>
            <button class="bg-gray-300 hover:bg-gray-400 font-bold py-4 rounded-lg text-xl transition" onclick="addNumber('5')">5</button>
            <button class="bg-gray-300 hover:bg-gray-400 font-bold py-4 rounded-lg text-xl transition" onclick="addNumber('6')">6</button>
            <button class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-4 rounded-lg text-xl transition" onclick="addOperator('+')">+</button>

            <button class="bg-gray-300 hover:bg-gray-400 font-bold py-4 rounded-lg text-xl transition" onclick="addNumber('1')">1</button>
            <button class="bg-gray-300 hover:bg-gray-400 font-bold py-4 rounded-lg text-xl transition" onclick="addNumber('2')">2</button>
            <button class="bg-gray-300 hover:bg-gray-400 font-bold py-4 rounded-lg text-xl transition" onclick="addNumber('3')">3</button>
            <button class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-4 rounded-lg text-xl transition row-span-2 flex items-center justify-center" onclick="calculate()">=</button>

            <button class="col-span-2 bg-gray-300 hover:bg-gray-400 font-bold py-4 rounded-lg text-xl transition" onclick="addNumber('0')">0</button>
            <button class="bg-gray-300 hover:bg-gray-400 font-bold py-4 rounded-lg text-xl transition" onclick="addNumber('.')">.</button>
        </div>

        <div id="error" class="mt-4 text-red-500 text-sm text-center hidden"></div>
    </div>

    <script>
        let expression = '';

        function addNumber(num) {
            expression += num;
            updateDisplay();
        }

        function addOperator(op) {
            if (expression && !expression.endsWith(' ')) {
                expression += ' ' + op + ' ';
            }
            updateDisplay();
        }

        function clearDisplay() {
            expression = '';
            updateDisplay();
            hideError();
        }

        function updateDisplay() {
            document.getElementById('display').value = expression || '0';
        }

        function calculate() {
            if (!expression.trim()) return;

            fetch('/api/calculate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ expression: expression })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    showError(data.error);
                } else {
                    expression = String(data.result);
                    hideError();
                    updateDisplay();
                }
            })
            .catch(error => {
                showError('計算エラー');
                console.error('Error:', error);
            });
        }

        function showError(message) {
            const errorEl = document.getElementById('error');
            errorEl.textContent = message;
            errorEl.classList.remove('hidden');
        }

        function hideError() {
            document.getElementById('error').classList.add('hidden');
        }

        // Initialize display
        updateDisplay();

        // Keyboard support
        document.addEventListener('keydown', (e) => {
            if (e.key >= '0' && e.key <= '9') addNumber(e.key);
            if (e.key === '.') addNumber('.');
            if (e.key === '+') addOperator('+');
            if (e.key === '-') addOperator('-');
            if (e.key === '*') addOperator('*');
            if (e.key === '/') { e.preventDefault(); addOperator('/'); }
            if (e.key === 'Enter') calculate();
            if (e.key === 'Backspace') {
                expression = expression.slice(0, -1);
                updateDisplay();
            }
            if (e.key === 'Escape') clearDisplay();
        });
    </script>
</body>
</html>
